name: Quarto Publish

on:
  workflow_dispatch:
  push:
    branches: [main] # Use brackets to ensure proper YAML array syntax

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    
    # Permissions are critical for allowing the Action to write to the gh-pages branch
    permissions:
      contents: write # To allow the Action to push to the gh-pages branch
      pages: write    # To allow deployment to GitHub Pages (optional, but good practice)
      id-token: write # Required for GitHub's Pages deployment

    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Crucial for fetching history needed by Quarto and Git

      - name: Set up Quarto
        uses: quarto-dev/quarto-actions/setup@v2

      # ➡️ NEW STEP ADDED: Install TinyTex for PDF/EPUB rendering
      - name: Install TinyTex
        uses: r-lib/actions/setup-tinytex@v2
        # This will install the TinyTex LaTeX distribution needed to render
        # formats like PDF and EPUB, resolving your previous error.

      # OPTIONAL: If your Quarto files use R code, uncomment and adjust this section:
      # - name: Set up R
      #   uses: r-lib/actions/setup-r@v2
      #   with:
      #     r-version: '4.3' # Specify your R version
      # 
      # - name: Restore R packages (using renv)
      #   shell: Rscript {0}
      #   run: |
      #     install.packages("renv")
      #     renv::restore()

      - name: Render and Publish
        uses: quarto-dev/quarto-actions/publish@v2
        with:
          target: gh-pages
          source: . # Publish the content from the root directory